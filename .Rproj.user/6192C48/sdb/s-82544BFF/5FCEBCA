{
    "collab_server" : "",
    "contents" : "#06_cvi_ndvi_plots.R\n#This script was written by J. Atkins 2015, 2016 (jeffatkins@virginia.edu or @atkinsjeff)\n#https://github.com/atkinsjeff\n#\n#This script makes all of the plots in the manuscript and some bonus stuff!\n#requires\n\nrequire(ggplot2)\nrequire(wesanderson)\n\nplot(ndvi.86,  col=rev( terrain.colors(10)), breaks = seq(0, 1, by = 0.1) )+\n     mtext(\"1986\")\nplot(ndvi.90,  col=rev( terrain.colors(10)), breaks = seq(0, 1, by = 0.1) )+\n     mtext(\"1990\")\nplot(ndvi.95,  col=rev( terrain.colors(10)), breaks = seq(0, 1, by = 0.1) )+\n     mtext(\"1995\")\nplot(ndvi.05,  col=rev( terrain.colors(10)), breaks = seq(0, 1, by = 0.1) )+\n     mtext(\"2005\")\nplot(ndvi.09,  col=rev( terrain.colors(10)), breaks = seq(0, 1, by = 0.1) )+\n     mtext(\"2009\")\nplot(ndvi.11,  col=rev( terrain.colors(10)), breaks = seq(0, 1, by = 0.1) )+\n     mtext(\"2011\")\n\n#trying another approach\nlibrary(gtable)\nlibrary(gridExtra)\n\n# Get the widths\ngA <- ggplot_gtable(ggplot_build(p.ndvi))\ngB <- ggplot_gtable(ggplot_build(p.di))\ngC <- ggplot_gtable(ggplot_build(p.green))\ngD <- ggplot_gtable(ggplot_build(p.gw))\ngX <- ggplot_gtable(ggplot_build(p.bright))\ngZ <- ggplot_gtable(ggplot_build(p.wet))\n\n\nmaxWidth = unit.pmax(gA$widths[2:3], gB$widths[2:3], \n                     gC$widths[2:3], gD$widths[2:3])\n\n# Set the widths\ngA$widths[2:3] <- maxWidth\ngB$widths[2:3] <- maxWidth\ngC$widths[2:3] <- maxWidth\ngD$widths[2:3] <- maxWidth\ngX$widths[2:3] <- maxWidth\ngZ$widths[2:3] <- maxWidth\n\n\n# Arrange the four charts\ngrid.arrange(gA, gC, gX, gZ, gB, gD, nrow=3)\n\n\n#####NDVI and streamdistance\npal <- wes_palette(\"Zissou\", 100, type = \"continuous\")\nimage(volcano, col = pal)\n#modified rushmore\nRushmore2 = c( \"#0B775E\", \"#35274A\" ,\"#F2300F\")\n\n\np.stream.ndvi.86 <- ggplot(class_ndvi, aes(x = ndvi.86, y = ndvi.11, color= stream_dist))+\n  geom_point(size=3, alpha=0.5)+\n  theme_bw()+\n  scale_colour_gradientn(colours = pal, \"Distance\\nfrom stream\") + \n  geom_abline(intercept=0, slope=1)+\n  xlim(0.25,0.75)+\n  ylim(0.25,0.75)+\n  xlab(\"NDVI (1986)\")+\n  ylab(\"NDVI (2011)\")+\n  theme(axis.title.x = element_text(size=20),\n        axis.text.x  = element_text(vjust=0.5, size=16),\n        axis.title.y = element_text(size=20),\n        axis.text.y  = element_text(size=16),\n        panel.grid.major = element_blank(), panel.grid.minor = element_blank())+\n        # theme(legend.justification=c(1,0), legend.position=c(1,0))\n        theme(legend.position=\"none\")\np.stream.ndvi\n\np.stream.ndvi.11 <- ggplot(class_ndvi, aes(x = stream_dist, y = ndvi.11))+\n  geom_point(size=4, alpha=0.5)+\n  theme_bw()+\n  # geom_abline(intercept=0, slope=1)+\n  # xlim(0.25,0.75)+\n  ylim(0.25,0.75)+\n  xlab(\"Distance from Stream (m)\")+\n  ylab(\"NDVI (2011)\")+\n  theme(axis.title.x = element_text(size=20),\n        axis.text.x  = element_text(vjust=0.5, size=16),\n        axis.title.y = element_text(size=20),\n        axis.text.y  = element_text(size=16),\n        panel.grid.major = element_blank(), panel.grid.minor = element_blank())+\n  geom_smooth(colour=\"darkgoldenrod1\", size=1.5, method=\"loess\", span=0.1)+\n  # theme(legend.justification=c(1,0), legend.position=c(1,0))\n  theme(legend.position=\"none\")+\n  geom_vline(xintercept=142.4, size = 2, color = \"#BD3039\", linetype = \"dashed\")\np.stream.ndvi.11\n\np.stream.ndvi.86 <- ggplot(class_ndvi, aes(x = stream_dist, y = ndvi.86))+\n  geom_point(size=4, alpha=0.5)+\n  theme_bw()+\n  # geom_abline(intercept=0, slope=1)+\n  ylim(0.25,0.75)+\n  xlab(\"Distance from Stream (m)\")+\n  ylab(\"NDVI (1986)\")+\n  theme(axis.title.x = element_text(size=20),\n        axis.text.x  = element_text(vjust=0.5, size=16),\n        axis.title.y = element_text(size=20),\n        axis.text.y  = element_text(size=16),\n        panel.grid.major = element_blank(), panel.grid.minor = element_blank())+\n  stat_smooth(colour=\"darkgoldenrod1\", size=1.5, method=\"loess\", span=0.1)+\n  # theme(legend.justification=c(1,0), legend.position=c(1,0))\n  theme(legend.position=\"none\")+\n  geom_vline(xintercept=136.7, size = 2, color = \"#BD3039\", linetype = \"dashed\")\np.stream.ndvi.86\n\np.elev.ndvi <- ggplot(class_ndvi, aes(x = ndvi.86, y = ndvi.11, color= elev))+\n  geom_point(size=3, alpha=0.5)+\n  theme_bw()+\n  scale_color_manual(values = Rushmore2, \"Elevation\\nclass\")+\n  geom_abline(intercept=0, slope=1)+\n  xlim(0.25,0.75)+\n  ylim(0.25,0.75)+\n  xlab(\"NDVI (1986)\")+\n  ylab(\"NDVI (2011)\")+\n  theme(axis.title.x = element_text(size=20),\n        axis.text.x  = element_text(vjust=0.5, size=16),\n        axis.title.y = element_text(size=20),\n        axis.text.y  = element_text(size=16),\n        panel.grid.major = element_blank(), panel.grid.minor = element_blank())+\n    #   theme(legend.justification=c(1,0), legend.position=c(1,0))\n        theme(legend.position=\"none\")\np.elev.ndvi\n\n##############GW model data\np.stream.gw <- ggplot(class_gw, aes(x = gw.86, y = gw.11, color= stream_dist))+\n  geom_point(size=3, alpha=0.5)+\n  theme_bw()+\n  scale_colour_gradientn(colours = pal, \"Distance\\nfrom stream\") + \n  geom_abline(intercept=0, slope=1)+\n  xlim(-0.2,0.0)+\n  ylim(-0.2,0.0)+\n  xlab(\"G + W (1986)\")+\n  ylab(\"G + W (2011)\")+\n  theme(axis.title.x = element_text(size=20),\n        axis.text.x  = element_text(vjust=0.5, size=16),\n        axis.title.y = element_text(size=20),\n        axis.text.y  = element_text(size=16),\n        panel.grid.major = element_blank(), panel.grid.minor = element_blank())+\n  theme(legend.justification=c(1,0), legend.position=c(1,0))\np.stream.gw\n\n\np.elev.gw <- ggplot(class_gw, aes(x = gw.86, y = gw.11, color= elev))+\n  geom_point(size=3, alpha=0.5)+\n  theme_bw()+\n  scale_color_manual(values = Rushmore2, \"Elevation\\nClass\")+\n  geom_abline(intercept=0, slope=1)+\n  xlim(-0.2,0.0)+\n  ylim(-0.2,0.0)+\n  xlab(\"G + W (1986)\")+\n  ylab(\"G + W (2011)\")+\n  theme(axis.title.x = element_text(size=20),\n        axis.text.x  = element_text(vjust=0.5, size=16),\n        axis.title.y = element_text(size=20),\n        axis.text.y  = element_text(size=16),\n        panel.grid.major = element_blank(), panel.grid.minor = element_blank())+\n        theme(legend.justification=c(1,0), legend.position=c(1,0))\np.elev.gw\n\n\n\n###GRID-ING THOSE PLOTS\n\n# Get the widths\ngE <- ggplot_gtable(ggplot_build(p.stream.ndvi))\ngF <- ggplot_gtable(ggplot_build(p.elev.ndvi))\ngG <- ggplot_gtable(ggplot_build(p.stream.gw))\ngH <- ggplot_gtable(ggplot_build(p.elev.gw))\n\n\nmaxWidth = unit.pmax(gE$widths[2:3], gF$widths[2:3], \n                     gG$widths[2:3], gH$widths[2:3])\n\n# Set the widths\ngE$widths[2:3] <- maxWidth\ngF$widths[2:3] <- maxWidth\ngG$widths[2:3] <- maxWidth\ngH$widths[2:3] <- maxWidth\n\n\n# Arrange the four charts\ngrid.arrange(gE, gF, gG, gH, nrow=2)\n\n\n\n\n####################################\n# Comparisons of static variables. No more year to year, but I am looking at 2011 shrub versus stream distance\n\n\np.stream.ndvi.class <- ggplot(riparian.ndvi, aes(x = stream_dist, y = ndvi.11))+\n  geom_point(size=4, alpha=0.5)+\n  geom_point(data = upland.ndvi, size=4, alpha=0.5 )+\n  theme_bw()+\n  # scale_colour_gradientn(colours = pal, \"Distance\\nfrom stream\") + \n     xlim(0, 800)+\n     ylim(0.25,0.75)+\n  xlab(\"Distance from Stream (m)\")+\n  ylab(\"NDVI (2011)\")+\n  theme(axis.title.x = element_text(size=20),\n        axis.text.x  = element_text(vjust=0.5, size=16),\n        axis.title.y = element_text(size=20),\n        axis.text.y  = element_text(size=16),\n        panel.grid.major = element_blank(), panel.grid.minor = element_blank())+\n  # theme(legend.justification=c(1,0), legend.position=c(1,0))\n  geom_smooth(colour=\"dodgerblue\", size=1.5, method=\"lm\", degree = 0, span=0.1, SE = FALSE, data = riparian.ndvi)+\n  theme(legend.position=\"none\")\np.stream.ndvi.class\n\n\n\n\n\n\n\n##### More landscape plots\n\n#looking at aspect and change\nplot(lm.ndvi.elev$aspect, lm.ndvi.elev$p.value)\nplot(lm.ndvi.elev$aspect, lm.ndvi.elev$change)\nplot(lm.ndvi.elev$stream_dist, lm.ndvi.elev$change)\nplot(lm.ndvi.elev$stream_dist, lm.ndvi.elev$p.value)\n\np.stream.p.value <- ggplot(lm.ndvi.elev, aes(x = stream_dist, y = p.value, color = p.class))+\n  geom_point()\n\np.stream.p.value\n\np.aspect.p.value <- ggplot(lm.ndvi.elev, aes(x = aspect, y = p.value, color = p.class))+\n  geom_point()\n\np.aspect.p.value\n\np.elev.raw.p.value <- ggplot(lm.ndvi.elev, aes(x = elev.raw, y = p.value, color = p.class))+\n  geom_point()+\n  xlim(950, 1200)\n\np.elev.raw.p.value\n\nndvi.aspect <- aggregate(lm.ndvi.elev$change, by=list(lm.ndvi.elev$aspect.class), FUN=mean)\nndvi.aspect.sd <- aggregate(lm.ndvi.elev$change, by=list(lm.ndvi.elev$aspect.class), FUN=sd)\nndvi.aspect.n <- aggregate(lm.ndvi.elev$change, by=list(lm.ndvi.elev$aspect.class), FUN=length)\n\nndvi.aspect.change <- merge(ndvi.aspect, ndvi.aspect.sd, by =\"Group.1\")\nndvi.aspect.change <- merge(ndvi.aspect.change, ndvi.aspect.n, by =\"Group.1\")\nndvi.aspect.change <- rename(ndvi.aspect.change, c(\"Group.1\" = \"aspect.class\", \"x.x\" = \"mean_change\",\"x.y\" = \"sd\",\"x\" =  \"n\" ))\nndvi.aspect.change$SE <- ndvi.aspect.change$sd / (sqrt(ndvi.aspect.change$n))\n\nlm.ndvi.elev$aspect.class = factor(lm.ndvi.elev$aspect.class, c(\"Northwest\", \"North\", \"Northeast\", \"East\", \"Southeast\",\"South\",\"Southwest\",\"West\",\"FLAT\"))\nboxplot(change ~ aspect.class, data = lm.ndvi.elev, ylab = \"NDVI change (1986-2011)\") +abline(h=0)\n\n\n\n\n\n#filled NDVI density plots by year \nd.gw.pos <- density(gw.lm.stack$change)\n\nplot(d.gw.pos, main = \"kernel density of G + W (postive)\", xlim=c(-0.3,0.3) )+\n  \n  polygon(d.gw.pos, col=\"blue\", border=\"black\")\nabline(v=0)\n\nd.ndvi<- density(ndvi.stack$change)\n\nplot(d.ndvi, main = \"kernel density of NDVI\", xlim=c(-0.3,0.3))\npolygon(d.ndvi, col=\"red\", border=\"black\")\nabline(v=0)\n\nd.di <- density(DI.86.11$di.86)\nplot(d.di, main = \"kernel density of delta DI\")\npolygon(d.di, col=\"red\", border=\"black\")\nabline(v=0)\nxlim=c(-5,5)\n\n#Making density plots of NDVI through time\nd.1986 <- density(x1986$ndvi)\nd.1990 <- density(x1990$ndvi)\nd.1995 <- density(x1995$ndvi)\nd.2005 <- density(x2005$ndvi)\nd.2009 <- density(x2009$ndvi)\nd.2011 <- density(x2011$ndvi)\n\n#this makes the joy division plot\npar(mfrow = c(6,1), mar=c(2,4,0,2))\nplot(d.1986, main=\"\", xaxt='n', cex.axis = 1.5, xlim = c(0,1), ylim = c(0,10))+\n  polygon(d.1986, col=\"black\", border=\"black\")+\n  title(\"1986\", line = -1.5, adj=0.8, cex.main = 2)\nplot(d.1990, main=\"\", xaxt='n',cex.axis = 1.5, xlim = c(0,1), ylim = c(0,10))+\n  polygon(d.1990, col=\"black\", border=\"black\")+\n  title(\"1990\", line = -1.5, adj=0.8, cex.main = 2)\nplot(d.1995, main=\"\", xaxt='n',cex.axis = 1.5,xlim = c(0,1), ylim = c(0,10))+\n  polygon(d.1995, col=\"black\", border=\"black\")+\n  title(\"1995\", line = -1.5, adj=0.8, cex.main = 2)\nplot(d.2005, main=\"\", xaxt='n',cex.axis = 1.5,xlim = c(0,1), ylim = c(0,10))+\n  polygon(d.2005, col=\"black\", border=\"black\")+\n  title(\"2005\", line = -1.5, adj=0.8, cex.main = 2)\nplot(d.2009, main=\"\", xaxt='n',cex.axis = 1.5,xlim = c(0,1), ylim = c(0,10))+\n  polygon(d.2009, col=\"black\", border=\"black\")+\n  title(\"2009\", line = -1.5, adj=0.8, cex.main = 2)\nplot(d.2011, main=\"\", cex.axis = 1.5, xlim = c(0,1), ylim = c(0,10))+\n  polygon(d.2011, col=\"black\", border=\"black\")+\n  title(\"2011\", line = -1.5, adj=0.8, cex.main = 2)\npar(mar = c(0, 0, 0, 0))\n\n#reset to default\ndev.off()\n\n\n",
    "created" : 1520533017118.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1250090276",
    "id" : "5FCEBCA",
    "lastKnownWriteTime" : 1520534188,
    "last_content_update" : 1520534188651,
    "path" : "C:/github/cvi_ndvi_redux/06_cvi_ndvi_plots.R",
    "project_path" : "06_cvi_ndvi_plots.R",
    "properties" : {
    },
    "relative_order" : 9,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}